{% extends "base_site.html" %}

{% block title %} Achoo {% endblock title %}

{% block stylesheets %}
  {{ super() }}
{% endblock stylesheets %}

{% block content %}

  <div class="right_col" role="main">
    <div class="">
{% if current_user.inhaler > 0 %}
      <a style="height:100px;margin-left:15%;margin-top:15%;" id="captureinhaler" value="inhaler" onclick="getLocation('inhaler')" class="col-xs-8 col-xs-8 btn btn-lg btn-primary">
        <i class=""></i> <h3>Inhaler</h3>
      </a>
 {% endif %}
{% if current_user.meds > 0 %}
      <a style="height:100px;margin-left:15%;margin-top:15%;" id="capturemeds" value="meds" onclick="getLocation('other')" class="col-xs-8 col-xs-8 btn btn-lg btn-primary">
        <i class=""></i> <h3>Other</h3>
      </a>
 {% endif %}
     </div>
  </div>

{% endblock content %}

{% block javascripts %}
  {{ super() }}

  <script>
    var treatmentUsed;

	function getLocation(treatment) {
		treatmentUsed = treatment;
	    if (navigator.geolocation) {
	        navigator.geolocation.getCurrentPosition(showPosition);
	    } else {}
	}

	function showPosition(position) {
		var postData = {};
		postData.treatment = treatmentUsed;
		postData.coords = {}
		postData.coords.latitude = position.coords.latitude;
		postData.coords.longitude = position.coords.longitude;
		postData.timestamp = position.timestamp;
		postData.accuracy = position.accuracy;
	    postPosition(postData);
	}

	function postPosition(postData){
		$.ajax({
		    type: "POST",
		    url: "/api/1.0/prediction/",
		    data: JSON.stringify(postData),
		    contentType: "application/json; charset=utf-8",
		    dataType: "json",
		    success: function(data){
		    	console.log(data);
		    },
		    failure: function(errMsg) {console.log(errMsg)}
		});
	}

  </script>
{% endblock javascripts %}
